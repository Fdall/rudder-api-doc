
This file describes REST API v2 for Rules.

Corresponding code is available here: 
https://github.com/Normation/rudder/blob/master/rudder-web/src/main/scala/com/normation/rudder/web/rest/rule/RuleAPI2.scala



/**
   @apiDefine ruleId

   @apiParam (URL parameters) {UUID} id ID of the Rule
 */

/**
   @apiDefine Mono Mono valued parameters - Those parameters will only work with one value
 */
/**
   @apiDefine Multi Multi valued parameters - Those parameters need to be entered several times, they will add each other to form a list.
 */

 /**
   @apiDefine ruleCreation

   @apiParam (Mono) {String}  displayName        Name of the Rule.
   @apiParam (Mono) {UUID}    [id=autoGenerated] Define the id of the Rule to create, Rudder will generate an id if this is missing. You should only use it for specific use case.
   @apiParam (Mono) {String}  [shortDescription] Short description of the Rule.
   @apiParam (Mono) {String}  [longDescription]  Long description of the Rule.
   @apiParam (Mono) {Boolean} [enabled=true]     enabled the Rule at creation. But this parameter can be overriden : if you want to create Rule with directives and Rule targets directly with workflow enabled, the Rule will be created disabled (to prevent creating active Rule without validation). But this parameter can be overriden. Used to be 'isEnabled' in response, look <a href="#non-compliant-data-in-response">here</a> for more details.
   @apiParam (Multi) {UUID}       [directives] link one directive to the Rule. value needs to be an existing directive ID.
   @apiParam (Multi) {RuleTarget} [targets]    Link one target to the Rule. Rule targets are "group:groupId" and the special targets : "special:all" and "special:all_exceptPolicyServers".
   @apiParam (Multi) {Tag}        [tags]       Tags linked to this Rule. As JSON, send an object { "key1":"value1", ..., "keyN":"valueN"}. As query paramereter, send a "key:value" pair for each tag.
 */

/**
   @apiDefine categoryId

   @apiParam (URL parameters) {UUID} id ID of the Rule category
 */


[GET] api/rules
-----------------

    /**
    @api {get} /api/rules 1. List all Rules
    @apiVersion 10.0.0
    @apiName listRules
    @apiGroup Rules
    @apiDescription Get all Rules available in Rudder
    
    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X GET 'http://rudder.example.com/rudder/api/latest/rules?prettify=true'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
      {
        "action":"listRules",
        "result":"success",
        "data":{
          "rules":[{
            "id":"bb803bc8-2df7-4734-a6b6-454476c82bc6",
            "displayName":"to",
            "shortDescription":"",
            "longDescription":"",
            "directives":[],
            "targets":[],
            "enabled":false,
            "system":false
          },{
            "id":"628abf7b-8b5c-4c44-8cca-437b636a9523",
            "displayName":"My roule",
            "shortDescription":"",
            "longDescription":"",
            "directives":["e61c0696-172b-46bb-80a9-d6f5ef1d2f85"],
            "targets":["special:all_exceptPolicyServers"],
            "enabled":true,
            "system":false
          },{
            "id":"06ba8940-ed6c-4102-ba46-93d640a64c36",
            "displayName":"My first Rule",
            "shortDescription":"",
            "longDescription":"",
            "directives":["cba93d24-8780-4308-b732-84995125562a","7d44f9ad-9a54-4165-bb46-f66e6c674b39","6847ad49-1c7e-4314-b764-ec176b882b6b","19be05b2-fb68-4ae1-acc0-e0ad2eba71fd","0be6fb7c-42c5-419e-9f6f-eb13ac4e4acd"],
            "targets":["group:3b9be575-590d-4fe4-9fa5-cc166d985ccf"],
            "enabled":false,
            "system":false
          }]
        }
      }


     */


[PUT] api/rules
-----------------

    /**
    @api {put} /api/rules 3. Create a new Rule
    @apiVersion 10.0.0
    @apiName createRule
    @apiGroup Rules
    @apiDescription Create a new Rule in Rudder. You can define all of its parameters, but you need at least its name
    
    @apiUse ruleCreation
 

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken -X PUT 'http://rudder.example.com/rudder/api/latest/rules' -d "displayName=Name of New Rule"

     */


[PUT] api/rules
-----------------

    /**
    @api {put} /api/rules 6. Clone a Rule
    @apiVersion 10.0.0
    @apiName cloneRule
    @apiGroup Rules
    @apiDescription Create a new Rule based on an existing Rule. you can still modify its parameters, but you need at least to specify the name of the new Rule 

    @apiParam (Mono) {UUID} source ID of the Rule the clone will be based onto. if this parameter is missing there will be only a Rule creation.
    @apiUse ruleCreation
    
    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X PUT 'http://rudder.example.com/rudder/api/latest/rules?prettify=true'  -d "source=RuleIDSource" -d "displayName=Name of New Rule‚Äù

    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
      {
        "action":"createRule",
        "id":"73fb7802-5326-483a-a6d6-c29e78449558",
        "result":"success",
        "data":{
          "rules":[{
            "id":"73fb7802-5326-483a-a6d6-c29e78449558",
            "displayName":"Cloned Rule",
            "shortDescription":"",
            "longDescription":"",
            "directives":["c4f58823-5cd6-455b-b0bc-1511c51e2533"],
            "targets":["group:1e975cb2-b929-46f5-9b1c-5e4d5d5f1027"],
            "enabled":false,
            "system":false
          }]
        }
      }

    @apiErrorExample Error-Response:
      HTTP/1.1 500 Server Error
      {
        "action":"createRule",
        "id":"4f7fb9e5-e9e2-41be-99fc-bfd95a733360",
        "result":"error",
      }

     */

[GET] api/rules/{id}
--------------------------

    /**
    @api {get} /api/rules/{id} 2. Get a Rule details
    @apiVersion 10.0.0
    @apiName ruleDetails
    @apiGroup Rules
    @apiDescription Get details for one Rule by specifying its ID in the URL
    
    @apiUse ruleId

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X GET 'http://rudder.example.com/rudder/api/latest/rules/06ba8940-ed6c-4102-ba46-93d640a64c36?prettify=true'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
      {
        "action":"ruleDetails",
        "id":"06ba8940-ed6c-4102-ba46-93d640a64c36",
        "result":"success",
        "data":{
          "rules":[{
            "id":"06ba8940-ed6c-4102-ba46-93d640a64c36",
            "displayName":"My first Rule",
            "shortDescription":"",
            "longDescription":"",
            "directives":["cba93d24-8780-4308-b732-84995125562a","7d44f9ad-9a54-4165-bb46-f66e6c674b39","6847ad49-1c7e-4314-b764-ec176b882b6b","19be05b2-fb68-4ae1-acc0-e0ad2eba71fd","0be6fb7c-42c5-419e-9f6f-eb13ac4e4acd"],
            "targets":["group:3b9be575-590d-4fe4-9fa5-cc166d985ccf"], 
            "enabled":false,
            "system":false
          }]
        }
      }


    */

[DELETE] api/rules/{id}
--------------------------

    /**
    @api {delete} /api/rules/{id} 5. Delete a Rule
    @apiVersion 10.0.0
    @apiName deleteRule
    @apiGroup Rules
    @apiDescription Delete the Rule having the ID passed in the URL
    
    @apiUse ruleId

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X DELETE 'http://rudder.example.com/rudder/api/latest/rules/176ad06b-ed02-4da3-8053-16225d217741?prettify=true'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
      {
        "action":"deleteRule",
        "id":"176ad06b-ed02-4da3-8053-16225d217741",
        "result":"success",
        "data":{
          "rules":[{
            "changeRequestId":"47",
            "id":"176ad06b-ed02-4da3-8053-16225d217741",
            "displayName":"toto2",
            "shortDescription":"",
            "longDescription":"",
            "directives":[],
            "targets":[],
            "enabled":false,
            "system":false
          }]
        }
      }

    @apiErrorExample Error-Response:
      HTTP/1.1 500
      {
        "action":"deleteRule",
        "id":"176ad06b-ed02-4da3-8053-16225d217741",
        "result":"error",
        "error details":"Could not delete Rule 176ad06b-ed02-4da3-8053-16225d217741 cause is: Could not find Rule 176ad06b-ed02-4da3-8053-16225d217741."
      }

    */


[POST] api/rules/{id}
--------------------------

    /**
    @api {post} /api/rules/{id} 4. Update a Rule
    @apiVersion 10.0.0
    @apiName updateRule
    @apiGroup Rules
    @apiDescription Modify any parameters of a Rule. Missing parameters means to not modify that parameter
    
    @apiUse ruleId

    @apiParam (Mono) {String}  [displayName]      Name of the Rule.
    @apiParam (Mono) {Boolean} [enabled]          Enable/disable the Rule. Used to be 'isEnabled' in response, look <a href="#non-compliant-data-in-response">here</a> for more details.

    @apiParam (Mono) {String}  [shortDescription] Short description of the Rule.
    @apiParam (Mono) {String}  [longDescription]  Long description of the Rule.

    @apiParam (Multi) {UUID}       [directives] Link one directive to the Rule. value needs to be an existing directive ID.
    @apiParam (Multi) {Ruletarget} [targets]    Link one target to the Rule. Rule targets are for groups : "group:groupId", nodes : "node:nodeId" and the special targets : "special:all" and "special:all_exceptPolicyServers".
   @apiParam (Multi) {Tag}        [tags]       Tags linked to this Rule. As JSON, send an object { "key1":"value1", ..., "keyN":"valueN"}. As query paramereter, send a "key:value" pair for each tag.
    @apiExample Example usage:
    Update display name: 
    curl -H "X-API-Token: yourToken" -X POST 'http://rudder.example.com/rudder/api/latest/rules/RuleID' -d "displayName=Name of Rule"


    */


[GET] api/rules/tree
-----------------

    /**
    @api {get} /api/rules/tree 7. Get Rules tree 
    @apiVersion 10.0.0
    @apiName GetRuleTree
    @apiGroup Rules
    @apiDescription Get all Rules available in Rudder and their cateogries in a Tree
    
    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X GET 'http://rudder.example.com/rudder/api/latest/rules/tree?prettify=true'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
{
  "action": "GetRuleTree",
  "result": "success",
  "data": {
    "ruleCategories": {
      "id": "rootRuleCategory",
      "name": "Rules",
      "description": "This is the main category of Rules",
      "parent": "rootRuleCategory",
      "categories": [
        {
          "id": "4306143d-eabf-4478-b7b1-1616f4aa02b5",
          "name": "Dev category",
          "description": "",
          "parent": "rootRuleCategory",
          "categories": [
            {
              "id": "f45ec2fd-69f4-4669-9c22-1af3abe2a107",
              "name": "Specific dev category",
              "description": "",
              "parent": "4306143d-eabf-4478-b7b1-1616f4aa02b5",
              "categories": [
                
              ],
              "rules": [
                {
                   "id": "b7fda4e7-3616-4e99-89b0-8ffadaf6b0f0",
                   "displayName": "my specific Rule",
                   "shortDescription": "",
                   "longDescription": "",
                   "directives": [],
                   "targets": [],
                   "enabled": true,
                   "system": false
                }
              ]
            }
          ],
          "rules": [
            {
              "id": "f2aa50a9-961c-4cce-a266-380cffcdce32",
              "displayName": "dev Rule",
              "shortDescription": "",
              "longDescription": "",
              "directives": [],
              "targets": [],
              "enabled": true,
              "system": false
            }
          ]
        }
      ],
      "rules": [
        {
          "id": "43cde273-5bb0-466f-8850-7d3fdde03253",
          "displayName": "Global security policy",
          "shortDescription": "",
          "longDescription": "",
          "directives": [],
          "targets": [],
          "enabled": true,
          "system": false
        },
        {
          "id": "32377fd7-02fd-43d0-aab7-28460a91347b",
          "displayName": "Global configuration for all nodes",
          "shortDescription": "",
          "longDescription": "This Rule was created automatically when Rudder was installed. It can be used to target Directives to all nodes (including the Rudder root server itself), or deleted if you would rather create your own set of Rules (it will never be created again).",
          "directives": [
            "bff45fe2-8233-4d28-96aa-78b0390b548b"
          ],
          "targets": [
            {
              "include": {
                "or": [
                  "special:all",
                  "special:all_exceptPolicyServers",
                  "special:all_nodes_without_role"
                ]
              },
              "exclude": {
                "or": [
                  
                ]
              }
            }
          ],
          "enabled": false,
          "system": false
        }
      ]
    }
  }
}

     */


[GET] api/rules/categories/{id}
--------------------------

    /**
    @api {get} /api/rules/categories/{id} 8. Get a Rule category details
    @apiVersion 10.0.0
    @apiName getRuleCategoryDetails
    @apiGroup Rules
    @apiDescription Get the details of a Rule category, whose ID is specified in the URL
    
    @apiUse categoryId

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X GET 'http://rudder.example.com/rudder/api/latest/rules/categories/4306143d-eabf-4478-b7b1-1616f4aa02b5?prettify=true'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
{
  "action": "getRuleCategoryDetails",
  "result": "success",
  "data": {
    "ruleCategories": {
      "id": "4306143d-eabf-4478-b7b1-1616f4aa02b5",
      "name": "another",
      "description": "",
      "parent": "rootRuleCategory",
      "categories": [
        "6c676103-0abf-4614-b0bd-19768e1bec15"
      ],
      "rules": [
        "16fd4e1a-0364-4123-8a84-ff34caee5bf6"
      ]
    }
  }
}


    */

[DELETE] api/rules/categories/{id}
--------------------------

    /**
    @api {get} /api/rules/categories/{id} 9. Delete a Rule category
    @apiVersion 10.0.0
    @apiName deleteRuleCategory
    @apiGroup Rules
    @apiDescription Delete a Rule category. It must have no child rules and no children categories
    
    @apiUse categoryId

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X DELETE 'http://rudder.example.com/rudder/api/latest/rules/categories/4306143d-eabf-4478-b7b1-1616f4aa02b5?prettify=true'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
{
  "action": "deleteRuleCategory",
  "result": "success",
  "data": {
    "ruleCategories": {
      "id": "4306143d-eabf-4478-b7b1-1616f4aa02b5",
      "name": "another",
      "description": "",
      "parent": "rootRuleCategory",
      "categories": [
        "6c676103-0abf-4614-b0bd-19768e1bec15"
      ],
      "rules": [
        "16fd4e1a-0364-4123-8a84-ff34caee5bf6"
      ]
    }
  }
}


    */

[POST] api/rules/categories/{id}
--------------------------

    /**
    @api {post} /api/rules/categories/{id} 10. Update a Rule Category
    @apiVersion 10.0.0
    @apiName updateRuleCategory
    @apiGroup Rules
    @apiDescription Modify any parameters of a Rule category. Missing parameters means to not modify that parameter
    
    @apiUse categoryId

    @apiParam (Mono) {String}  [name]      Name of the Rule category.
   @apiParam (Mono) {String}  [description] Description of the Rule category.
   @apiParam (Mono) {UUID}    [Parent]      Id of the parent Rule category

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X POST 'http://rudder.example.com/rudder/api/latest/rules/categories/4306143d-eabf-4478-b7b1-1616f4aa02b5?prettify=true' -d "name=new category name"
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
{
  "action": "updateRuleCategory",
  "result": "success",
  "data": {
    "ruleCategories": {
      "id": "4306143d-eabf-4478-b7b1-1616f4aa02b5",
      "name": "new category name",
      "description": "",
      "parent": "rootRuleCategory",
      "categories": [
        "6c676103-0abf-4614-b0bd-19768e1bec15"
      ],
      "rules": [
        "16fd4e1a-0364-4123-8a84-ff34caee5bf6"
      ]
    }
  }
}

    */


[PUT] api/rules/categories
-----------------

    /**
    @api {put} /api/rules/categories 11. Create a new Rule category.
    @apiVersion 10.0.0
    @apiName createRuleCategory
    @apiGroup Rules
    @apiDescription Create a new Rule category in Rudder. You can define all of its parameters, but you need at least its name
    
    @apiParam (Mono) {String}  name          Name of the Rule category.
    @apiParam (Mono) {String}  [description] Description of the Rule category.
    @apiParam (Mono) {UUID}    [parent]      Id of the parent Rule category

    @apiExample Example usage:
    curl -H "X-API-Token: yourToken" -X POST 'http://rudder.example.com/rudder/api/latest/rules/categories' -d "name=new category" -d "parent=4306143d-eabf-4478-b7b1-1616f4aa02b5" -d "description=A new category created via API'
    @apiSuccessExample Success-Response:
      HTTP/1.1 200 OK
{
  "action": "createRuleCategory",
  "result": "success",
  "data": {
    "ruleCategories": {
      "id": "370521d0-b05c-4ba6-b3e9-c391887897a4",
      "name": "new category name",
      "description": "A new category created via API",
      "parent": "4306143d-eabf-4478-b7b1-1616f4aa02b5",
      "categories": [],
      "rules": []
    }
  }
}


     */

